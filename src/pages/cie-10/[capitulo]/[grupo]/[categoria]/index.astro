---
import Layout from "@/layouts/Layout.astro";
import type { Capitulo } from "@/data/cie10";
import data from "@/data/cie10.json";

const { capitulo = "", grupo = "", categoria = "" } = Astro.params;

const capitulos = data as Capitulo[];
const selectedCapitulo = capitulos.find((c) => c.codigo === capitulo);
const selectedGrupo = selectedCapitulo?.grupos.find((g) => g.codigo === grupo);
const selectedCategoria = selectedGrupo?.categorias.find((cat) => cat.codigo === categoria);

const breadcrumbs = [
  { label: "CIE-10", href: "/cie-10" },
  { label: selectedCapitulo?.codigo || "Capítulo desconocido", href: `/cie-10/${encodeURIComponent(capitulo)}` },
  { label: selectedGrupo?.codigo || "Grupo desconocido", href: `/cie-10/${encodeURIComponent(capitulo)}/${encodeURIComponent(grupo)}` },
  { label: selectedCategoria?.codigo || "Categoría desconocida" }
];
---

<Layout
  title={`${selectedCategoria?.codigo || "Categoría desconocida"} - ${selectedGrupo?.codigo || ""}`}
  heading={selectedCategoria?.nombre || "Categoría no encontrada"}
  breadcrumbs={breadcrumbs}
>
  <section class="py-8 flex flex-col gap-6">
    {
      selectedCategoria
        ? selectedCategoria.subcategorias.length > 0
          ? selectedCategoria.subcategorias.map((sub) => (
              <article>
                <div class="p-6 border border-gray-300 rounded-xl hover:bg-gray-100 transition">
                  <h2 class="text-xl font-semibold">{sub.codigo}</h2>
                  <p class="text-gray-600 text-sm">{sub.nombre}</p>
                </div>
              </article>
            ))
          : <p class="text-gray-600">Esta categoría no tiene subcategorías.</p>
        : <p class="text-red-600">Categoría no encontrada en el grupo</p>
    }
  </section>
</Layout>
