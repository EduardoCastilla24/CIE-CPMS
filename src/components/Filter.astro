<div class="mt-6">
    <input
        id="global-filter"
        type="search"
        placeholder="Buscar..."
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 text-sm md:text-base"
    />
</div>

<script type="module">
    function handleFilter(e) {
        const query = e.target.value.toLowerCase();

        document.querySelectorAll("[data-filter='true']").forEach((section) => {
        const items = section.querySelectorAll("[data-item]");
        let visibles = 0;

        items.forEach((item) => {
            const match = item.textContent.toLowerCase().includes(query);
            item.hidden = !match;
            if (match) visibles++;
        });

        let msg =
            section.querySelector(".no-results") ??
            section.appendChild(
            Object.assign(document.createElement("div"), {
                className: "no-results text-gray-500 text-sm text-center w-full",
                textContent: "No se encontraron resultados",
            })
            );

        msg.hidden = visibles > 0;
        });
    }

    function initFilter() {
        const input = document.getElementById("global-filter");
        if (!input) return;
        input.removeEventListener("input", handleFilter);
        input.addEventListener("input", handleFilter);
    }

    // Inicializar en carga inicial
    document.addEventListener("astro:page-load", () => {
        initFilter();
    });

    // También re-inicializar después del swap
    document.addEventListener("astro:after-swap", () => {
        initFilter();
    });
</script>
